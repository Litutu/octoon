INCLUDE_DIRECTORIES(${OCTOON_LIBRARY_OUTPUT_PATH})

INCLUDE(ExternalProject)


IF(NOT OCTOON_BUILD_PLATFORM_EMSCRIPTEN)
    ADD_SUBDIRECTORY(glew)
    ADD_SUBDIRECTORY(glfw)
ENDIF()
ADD_SUBDIRECTORY(zlib)
ADD_SUBDIRECTORY(imgui)
ADD_SUBDIRECTORY(ImGuizmo)
ADD_SUBDIRECTORY(DirectX)
ADD_SUBDIRECTORY(HLSLCrossCompiler)
ADD_SUBDIRECTORY(unzip)
ADD_SUBDIRECTORY(zipper)
ADD_SUBDIRECTORY(freetype-2.9)
ADD_SUBDIRECTORY(libjpeg)
ADD_SUBDIRECTORY(libpng)
ADD_SUBDIRECTORY(gles)
ADD_SUBDIRECTORY(openal-soft)
ExternalProject_Add(Catch2
    GIT_REPOSITORY https://github.com/catchorg/Catch2.git
    GIT_TAG 2f631bb8087a0355d2b23a75a28d936ce237659d
    GIT_SHALLOW true
    GIT_PROGRESS true
    PREFIX ${TENSORA_PATH_DEPENDENCIES}/Catch2
    CMAKE_ARGS -DCMAKE_INSTALL_PREFIX:path=${OCTOON_PATH_INSTALL}/ -DBUILD_SHARED_LIBS=OFF
)

ExternalProject_Add(
    prorender
    GIT_REPOSITORY https://github.com/GPUOpen-LibrariesAndSDKs/RadeonProRender-Baikal.git
    GIT_TAG 2d5a5d0eb2092d75adf637bf6f381d7e9307e986
    GIT_SHALLOW TRUE
    GIT_PROGRESS TRUE
    PREFIX ${OCTOON_PATH_DEPENDENCIES}/RadeonProRender-Baikal
    CMAKE_ARGS -DCMAKE_INSTALL_PREFIX:PATH=${OCTOON_PATH_INSTALL}/install -DBUILD_SHARED_LIBS=OFF
)

IF(OCTOON_BUILD_PLATFORM_WINDOWS)
ExternalProject_Add(
    physx
    GIT_REPOSITORY https://github.com/NVIDIAGameWorks/PhysX.git
    GIT_TAG 4050bbfdc2699dfab7edbf0393df8ff96bbe06c5
    GIT_SHALLOW TRUE
    GIT_PROGRESS TRUE
    PREFIX ${OCTOON_PATH_DEPENDENCIES}/PhysX
    CONFIGURE_COMMAND ${PYTHON_EXECUTABLE} ${OCTOON_PATH_DEPENDENCIES}/PhysX/src/physx/physx/buildtools/cmake_generate_projects.py 10
    BUILD_COMMAND  cmake --build ${OCTOON_PATH_DEPENDENCIES}/PhysX/src/physx/physx/compiler/vc15win64
)
ELSE()
	MESSAGE(FATAL_ERROR "Unsupported build platform for PhysX: " ${OCTOON_BUILD_PLATFORM})
ENDIF()

IF(NOT OCTOON_BUILD_PLATFORM_EMSCRIPTEN)
    SET_TARGET_ATTRIBUTE(glew "contrib")
    SET_TARGET_ATTRIBUTE(glfw "contrib")
ENDIF()
SET_TARGET_ATTRIBUTE(zlib "contrib")
SET_TARGET_ATTRIBUTE(unzip "contrib")
SET_TARGET_ATTRIBUTE(zipper "contrib")
SET_TARGET_ATTRIBUTE(imgui "contrib")
SET_TARGET_ATTRIBUTE(libHLSLcc "contrib")
SET_TARGET_ATTRIBUTE(ImGuizmo "contrib")
SET_TARGET_ATTRIBUTE(freetype "contrib")
SET_TARGET_ATTRIBUTE(dist "contrib")
SET_TARGET_ATTRIBUTE(libjpeg "contrib")
SET_TARGET_ATTRIBUTE(libpng "contrib")
SET_TARGET_ATTRIBUTE(OpenAL "contrib")
SET_TARGET_ATTRIBUTE(prorender "contrib")
SET_TARGET_ATTRIBUTE(physx "contrib")

IF(OCTOON_BUILD_PLATFORM_EMSCRIPTEN)
	ADD_SUBDIRECTORY(iGLU-1.0.0)
	SET_TARGET_ATTRIBUTE(iGLU "contrib")
ENDIF()